<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantrax Value Hunter - V2.0 Enhanced - Cache Bust 2025-08-22-213500</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="dashboard-container">
        <!-- Left Panel: Parameter Controls -->
        <div class="left-panel">
            <!-- Header -->
            <div class="panel-header">
                <h2>Parameter Controls</h2>
                <div class="formula-version-badge v2-enhanced">
                    <span class="version-indicator">V2.0</span>
                    <span class="formula-label">Enhanced</span>
                </div>
            </div>

            <!-- V2.0 Features List -->
            <div class="parameter-group v2-features">
                <div class="feature-list">
                    <div class="feature-item enabled">
                        <span class="checkmark">‚úì</span>
                        <span>Separated True Value & ROI</span>
                    </div>
                    <div class="feature-item enabled">
                        <span class="checkmark">‚úì</span>
                        <span>EWMA Form (Œ±=0.87)</span>
                    </div>
                    <div class="feature-item enabled">
                        <span class="checkmark">‚úì</span>
                        <span>Dynamic Blending</span>
                    </div>
                    <div class="feature-item enabled">
                        <span class="checkmark">‚úì</span>
                        <span>Normalized xGI</span>
                    </div>
                    <div class="feature-item enabled">
                        <span class="checkmark">‚úì</span>
                        <span>Exponential Fixtures</span>
                    </div>
                </div>
                <div class="v2-description">
                    <em>v2.0 provides research-validated calculations with 10-15% better accuracy</em>
                </div>
            </div>

            <!-- Model Validation Status -->
            <div class="parameter-group model-validation">
                <div class="group-header">
                    <span class="status-indicator not-available">‚óè</span>
                    <h3>Model Validation Status</h3>
                </div>
                <div class="validation-grid">
                    <div class="metric-item">
                        <div class="metric-label">RMSE:</div>
                        <div class="metric-value" id="rmse-value">--</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Correlation:</div>
                        <div class="metric-value" id="correlation-value">--</div>
                    </div>
                    <div class="metric-item">
                        <div class="metric-label">Precision@20:</div>
                        <div class="metric-value" id="precision-value">--</div>
                    </div>
                </div>
                <div class="validation-buttons">
                    <button id="runValidation" class="btn btn-primary btn-small">üèÉ Run Validation</button>
                    <button id="viewResults" class="btn btn-secondary btn-small">üìä View Results</button>
                </div>
                <div class="validation-note">
                    <small>Last validation: Not run<br>
                    <em>Run validation to assess model quality and performance metrics.</em></small>
                </div>
            </div>

            <!-- EWMA Form Calculation -->
            <div class="parameter-group">
                <div class="group-header">
                    <h3>EWMA Form Calculation</h3>
                </div>
                <div class="parameter-content">
                    <div class="slider-container">
                        <label for="ewmaAlpha">EWMA Alpha (Œ±):</label>
                        <input type="range" id="ewmaAlpha" min="0.1" max="1.0" step="0.01" value="0.87">
                        <span class="slider-value" id="ewmaAlphaValue">0.87</span>
                    </div>
                    <div class="half-life-display">
                        <small>Half-life: <span id="halfLife">~0.3 games</span></small>
                    </div>
                </div>
            </div>

            <!-- Dynamic Blending -->
            <div class="parameter-group">
                <div class="group-header">
                    <h3>Dynamic Blending</h3>
                </div>
                <div class="parameter-content">
                    <div class="slider-container">
                        <label for="adaptationGameweek">Adaptation Gameweek (K):</label>
                        <input type="range" id="adaptationGameweek" min="8" max="20" step="1" value="16">
                        <span class="slider-value" id="adaptationGameweekValue">16</span>
                    </div>
                </div>
            </div>

            <!-- Normalized xGI -->
            <div class="parameter-group">
                <div class="group-header">
                    <h3>Normalized xGI</h3>
                </div>
                <div class="parameter-content">
                    <div class="toggle-container">
                        <label class="toggle-switch">
                            <input type="checkbox" id="xgiEnabled">
                            <span class="toggle-slider"></span>
                        </label>
                        <span class="toggle-label">Enable xGI Calculations</span>
                    </div>
                    <div class="xgi-controls" id="xgiControls" style="display: none;">
                        <div class="slider-container">
                            <label for="xgiStrength">Normalization Strength:</label>
                            <input type="range" id="xgiStrength" min="0.5" max="2.0" step="0.1" value="1.0">
                            <span class="slider-value" id="xgiStrengthValue">1.0</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Multiplier Caps -->
            <div class="parameter-group">
                <div class="group-header">
                    <h3>Multiplier Caps</h3>
                </div>
                <div class="parameter-content">
                    <div class="slider-container">
                        <label for="formCap">Form Cap:</label>
                        <input type="range" id="formCap" min="1.5" max="3.0" step="0.1" value="2.0">
                        <span class="slider-value" id="formCapValue">2.0</span>
                    </div>
                    <div class="slider-container">
                        <label for="fixtureCap">Fixture Cap:</label>
                        <input type="range" id="fixtureCap" min="1.3" max="2.5" step="0.1" value="1.8">
                        <span class="slider-value" id="fixtureCapValue">1.8</span>
                    </div>
                    <div class="slider-container">
                        <label for="xgiCap">xGI Cap:</label>
                        <input type="range" id="xgiCap" min="2.0" max="4.0" step="0.1" value="2.5">
                        <span class="slider-value" id="xgiCapValue">2.5</span>
                    </div>
                    <div class="slider-container">
                        <label for="globalCap">Global Cap:</label>
                        <input type="range" id="globalCap" min="2.5" max="5.0" step="0.1" value="3.0">
                        <span class="slider-value" id="globalCapValue">3.0</span>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="action-buttons">
                <button id="applyChanges" class="btn btn-primary btn-large">Apply Changes</button>
                <div class="secondary-actions">
                    <button id="syncUnderstat" class="btn btn-secondary">Sync Understat Data</button>
                    <button id="importLineup" class="btn btn-secondary">Import Lineup</button>
                    <a href="/form-upload" class="btn btn-link">Upload Weekly Game Data</a>
                    <a href="/odds-upload" class="btn btn-link">Upload Odds</a>
                </div>
            </div>
        </div>

        <!-- Right Panel: Player Table -->
        <div class="right-panel">
            <!-- Header -->
            <div class="panel-header">
                <h2>All 633 Premier League Players</h2>
            </div>

            <!-- Filters and Controls -->
            <div class="table-controls">
                <div class="filters-row">
                    <!-- Position Filter -->
                    <div class="filter-group">
                        <label>Position:</label>
                        <div class="position-buttons">
                            <button class="position-btn active" data-position="all">All</button>
                            <button class="position-btn" data-position="G">G</button>
                            <button class="position-btn" data-position="D">D</button>
                            <button class="position-btn" data-position="M">M</button>
                            <button class="position-btn" data-position="F">F</button>
                        </div>
                    </div>

                    <!-- Price Filter -->
                    <div class="filter-group">
                        <label>Price Range:</label>
                        <input type="number" id="priceMin" placeholder="4.0" step="0.5" value="4.0" style="width: 60px;">
                        <span>to</span>
                        <input type="number" id="priceMax" placeholder="15.0" step="0.5" value="15.0" style="width: 60px;">
                    </div>

                    <!-- Team Filter -->
                    <div class="filter-group">
                        <label>Team:</label>
                        <select id="teamFilter" style="width: 120px;">
                            <option value="all">All Teams</option>
                        </select>
                    </div>

                    <!-- Search -->
                    <div class="filter-group">
                        <label>Search Player:</label>
                        <input type="text" id="playerSearch" placeholder="Enter player name..." style="width: 150px;">
                    </div>
                </div>

                <div class="controls-row">
                    <div class="pagination-controls">
                        <span>Showing <span id="playerCount">100</span> players</span>
                        <select id="pageSize">
                            <option value="50">50 per page</option>
                            <option value="100" selected>100 per page</option>
                            <option value="200">200 per page</option>
                            <option value="all">All</option>
                        </select>
                    </div>
                    <button id="exportCSV" class="btn btn-secondary">Export CSV</button>
                </div>
            </div>

            <!-- Player Table -->
            <div class="table-container">
                <table id="playersTable" class="players-table">
                    <thead>
                        <tr>
                            <th data-sort="name" class="sortable">Name ‚Üï</th>
                            <th data-sort="team" class="sortable">Team ‚Üï</th>
                            <th data-sort="position" class="sortable">Pos ‚Üï</th>
                            <th data-sort="price" class="sortable">Price ‚Üï</th>
                            <th data-sort="ppg" class="sortable">PPG ‚Üï</th>
                            <th data-sort="pps" class="sortable">PPS ‚Üï</th>
                            <th data-sort="games" class="sortable">Games ‚Üï</th>
                            <th data-sort="true_value" class="sortable highlight-column">True Value ‚Üï</th>
                            <th data-sort="roi" class="sortable highlight-column">ROI ‚Üï</th>
                            <th data-sort="form" class="sortable">Form ‚Üï</th>
                            <th data-sort="fixture" class="sortable">Fixture ‚Üï</th>
                            <th data-sort="starter" class="sortable">Starter ‚Üï</th>
                            <th data-sort="xgi" class="sortable">xGI ‚Üï</th>
                            <th data-sort="starter_override" class="sortable">Starter Override ‚Üï</th>
                            <th data-sort="xgi90" class="sortable">xGI90 ‚Üï</th>
                            <th data-sort="xgi90_h" class="sortable">xGI90_H ‚Üï</th>
                            <th data-sort="min" class="sortable">Min ‚Üï</th>
                        </tr>
                    </thead>
                    <tbody id="playersTableBody">
                        <!-- Table rows will be populated by JavaScript -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="pagination">
                <button id="prevPage" class="btn btn-secondary">Previous</button>
                <span id="pageInfo">Page 1 of 1</span>
                <button id="nextPage" class="btn btn-secondary">Next</button>
            </div>
        </div>
    </div>

    <!-- Load JavaScript -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>