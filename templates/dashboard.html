<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fantrax Crusher 2000 - Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header with Epic Banner -->
        <header class="header">
            <div class="banner-container">
                <img src="{{ url_for('static', filename='images/fantrax-dominator-banner.png') }}" alt="The Fantrax Dominator" class="banner-image">
                <button class="theme-toggle" id="theme-toggle">üåô Dark Mode</button>
                <div class="banner-overlay">
                    <div class="status-info">
                        <span id="status-indicator" class="status-ready">‚ö° Ready</span>
                        <span id="player-count" class="player-count">üéØ 633 players loaded</span>
                        <span id="last-updated" class="last-updated">üïê Last updated: --</span>
                    </div>
                </div>
            </div>
        </header>

        <!-- Main Dashboard Layout -->
        <div class="dashboard">
            <!-- Left Panel - Parameter Controls -->
            <div class="left-panel">
                <h2>Parameter Controls</h2>
                
                <!-- Form Calculation Section -->
                <div class="parameter-section">
                    <h3>
                        <input type="checkbox" id="form-enabled" checked>
                        <label for="form-enabled">Form Calculation</label>
                    </h3>
                    <div class="form-controls" id="form-controls">
                        <div class="control-group">
                            <label for="lookback-period">Lookback Period:</label>
                            <select id="lookback-period">
                                <option value="3">3 games</option>
                                <option value="5" selected>5 games</option>
                            </select>
                        </div>
                        <div class="control-group">
                            <label for="min-games">Minimum Games:</label>
                            <input type="number" id="min-games" value="3" min="1" max="10">
                        </div>
                        <div class="control-group">
                            <label for="baseline-switchover">Baseline Switchover Gameweek:</label>
                            <input type="number" id="baseline-switchover" value="10" min="1" max="38">
                        </div>
                        <div class="slider-group">
                            <label for="form-strength-slider">Form Strength:</label>
                            <input type="range" id="form-strength-slider" min="0.5" max="2.0" step="0.1" value="1.0">
                            <span id="form-strength-display">1.00x</span>
                        </div>
                        <p class="help-text">Uses weighted average of recent games vs season average. Switches to historical data after switchover gameweek. Form strength adjusts how much form affects True Value.</p>
                    </div>
                </div>

                <!-- Fixture Difficulty Section -->
                <div class="parameter-section">
                    <h3>
                        <input type="checkbox" id="fixture-enabled" checked>
                        <label for="fixture-enabled">Odds-Based Fixture Difficulty</label>
                    </h3>
                    <div class="fixture-controls" id="fixture-controls">
                        <!-- Preset Selection -->
                        <div class="control-group">
                            <label for="fixture-preset">Preset:</label>
                            <select id="fixture-preset">
                                <option value="conservative">Conservative (¬±10%)</option>
                                <option value="balanced" selected>Balanced (¬±20%)</option>
                                <option value="aggressive">Aggressive (¬±30%)</option>
                                <option value="custom">Custom</option>
                            </select>
                        </div>
                        
                        <!-- Fine-tuning Controls -->
                        <div class="slider-group">
                            <label for="multiplier-strength-slider">Multiplier Strength:</label>
                            <input type="range" id="multiplier-strength-slider" min="0.1" max="0.5" step="0.05" value="0.2">
                            <span id="multiplier-strength-display">¬±20%</span>
                        </div>
                        
                        <!-- Position Weights -->
                        <div class="position-weights-section">
                            <h4>Position Weights</h4>
                            <div class="slider-group">
                                <label for="goalkeeper-weight-slider">Goalkeepers:</label>
                                <input type="range" id="goalkeeper-weight-slider" min="0.8" max="1.5" step="0.05" value="1.10">
                                <span id="goalkeeper-weight-display">110%</span>
                            </div>
                            <div class="slider-group">
                                <label for="defender-weight-slider">Defenders:</label>
                                <input type="range" id="defender-weight-slider" min="0.8" max="1.5" step="0.05" value="1.20">
                                <span id="defender-weight-display">120%</span>
                            </div>
                            <div class="slider-group">
                                <label for="midfielder-weight-slider">Midfielders:</label>
                                <input type="range" id="midfielder-weight-slider" min="0.8" max="1.5" step="0.05" value="1.00">
                                <span id="midfielder-weight-display">100%</span>
                            </div>
                            <div class="slider-group">
                                <label for="forward-weight-slider">Forwards:</label>
                                <input type="range" id="forward-weight-slider" min="0.8" max="1.5" step="0.05" value="1.05">
                                <span id="forward-weight-display">105%</span>
                            </div>
                        </div>
                        
                        <p class="help-text">
                            Uses real betting odds to calculate 21-point difficulty scale (-10 to +10). 
                            Position weights adjust impact based on role (defenders benefit more from clean sheets vs weaker teams).
                            Current data: Gameweek 2 (10 matches imported).
                        </p>
                    </div>
                </div>

                <!-- Starter Predictions Section -->
                <div class="parameter-section">
                    <h3>
                        <input type="checkbox" id="starter-enabled" checked>
                        <label for="starter-enabled">Starter Predictions</label>
                    </h3>
                    <div class="starter-controls" id="starter-controls">
                        <div class="slider-group">
                            <label for="rotation-penalty-slider">Auto Rotation Penalty:</label>
                            <input type="range" id="rotation-penalty-slider" min="0.5" max="0.8" step="0.05" value="0.65">
                            <span id="rotation-penalty-display">0.65x</span>
                        </div>
                        <div class="slider-group">
                            <label for="bench-penalty-slider">Force Bench Penalty:</label>
                            <input type="range" id="bench-penalty-slider" min="0.4" max="0.8" step="0.05" value="0.6">
                            <span id="bench-penalty-display">0.60x</span>
                        </div>
                        <p class="help-text">CSV import identifies predicted starters. Others receive rotation penalty.</p>
                    </div>
                </div>

                <!-- xGI Integration -->
                <div class="parameter-section">
                    <h3>
                        <input type="checkbox" id="xgiEnabled">
                        <label for="xgiEnabled">xGI Integration (Understat)</label>
                    </h3>
                    <div class="xgi-controls" id="xgiContent">
                        <div class="control-group">
                            <label for="xgiMode">Multiplier Mode:</label>
                            <select id="xgiMode">
                                <option value="direct">Direct (xGI90 √ó strength)</option>
                                <option value="adjusted">Adjusted (1 + xGI90 √ó strength)</option>
                                <option value="capped">Capped (0.5 - 1.5 range)</option>
                            </select>
                        </div>
                        <div class="slider-group">
                            <label for="xgiStrength">Multiplier Strength:</label>
                            <input type="range" id="xgiStrength" min="0" max="2" step="0.1" value="1.0">
                            <span id="xgiStrengthValue">1.0</span>
                        </div>
                        <div class="control-group">
                            <button id="syncUnderstat" class="btn-sync">Sync Understat Data</button>
                            <span id="syncStatus"></span>
                        </div>
                        <div class="stats-display">
                            <span id="xgiStats">Loading stats...</span>
                        </div>
                    </div>
                </div>

                <!-- Blender Display Configuration -->
                <div class="parameter-section">
                    <h3>
                        <input type="checkbox" id="gamesDisplayEnabled" checked>
                        <label for="gamesDisplayEnabled">Blender Display</label>
                    </h3>
                    <div class="games-display-controls" id="gamesDisplayContent">
                        <div class="control-group">
                            <label for="baselineSwitchover">Baseline Switchover Gameweek:</label>
                            <input type="number" id="baselineSwitchover" min="5" max="15" value="10">
                            <span class="help-text">When to start blending historical + current data</span>
                        </div>
                        <div class="control-group">
                            <label for="transitionEnd">Transition Period End:</label>
                            <input type="number" id="transitionEnd" min="10" max="20" value="15">
                            <span class="help-text">When to switch from blended to current-only</span>
                        </div>
                        <div class="control-group">
                            <input type="checkbox" id="showHistorical" checked>
                            <label for="showHistorical">Show Historical Data (24-25)</label>
                        </div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="action-buttons">
                    <button id="apply-changes" class="btn-primary" disabled>
                        Apply Changes
                    </button>
                    <button id="reset-defaults" class="btn-secondary">
                        Reset to Defaults
                    </button>
                    <button id="import-lineups" class="btn-secondary">
                        Import Lineups CSV
                    </button>
                    <button id="form-upload" class="btn-secondary" onclick="window.open('/form-upload', '_blank')">
                        üìä Upload Weekly Game Data
                    </button>
                    <button id="odds-upload" class="btn-secondary" onclick="window.open('/odds-upload', '_blank')">
                        ‚öΩ Upload Fixture Odds
                    </button>
                </div>

                <!-- Pending Changes Indicator -->
                <div id="pending-changes" class="pending-changes" style="display: none;">
                    <span>‚è≥ Changes pending...</span>
                </div>
            </div>

            <!-- Right Panel - Player Table -->
            <div class="right-panel">
                <h2>All 633 Premier League Players</h2>
                
                <!-- Filters Section -->
                <div class="filters-section">
                    <div class="filter-row">
                        <div class="filter-group">
                            <label>Position:</label>
                            <div class="checkbox-group">
                                <input type="checkbox" id="pos-g" value="G" checked>
                                <label for="pos-g">G</label>
                                <input type="checkbox" id="pos-d" value="D" checked>
                                <label for="pos-d">D</label>
                                <input type="checkbox" id="pos-m" value="M" checked>
                                <label for="pos-m">M</label>
                                <input type="checkbox" id="pos-f" value="F" checked>
                                <label for="pos-f">F</label>
                            </div>
                        </div>
                        
                        <div class="filter-group">
                            <label for="price-min">Price Range:</label>
                            <input type="number" id="price-min" value="5.0" step="0.1" min="5.0" max="25.0">
                            <span>to</span>
                            <input type="number" id="price-max" value="25.0" step="0.1" min="5.0" max="25.0">
                        </div>
                    </div>
                    
                    <div class="filter-row">
                        <div class="filter-group">
                            <label for="team-select">Team:</label>
                            <select id="team-select" multiple>
                                <option value="">All Teams</option>
                                <!-- Teams will be populated by JavaScript -->
                            </select>
                        </div>
                        
                        <div class="filter-group">
                            <label for="player-search">Search Player:</label>
                            <input type="text" id="player-search" placeholder="Enter player name...">
                        </div>
                    </div>
                    
                    <div class="filter-summary">
                        <span id="filter-count">Showing 633 players</span>
                        <button id="export-csv" class="btn-secondary">Export CSV</button>
                    </div>
                </div>

                <!-- Player Table -->
                <div class="table-container">
                    <table id="player-table" class="player-table">
                        <thead>
                            <tr>
                                <th data-sort="name">
                                    <div class="header-content">
                                        <span class="header-text">Name</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="name">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="team">
                                    <div class="header-content">
                                        <span class="header-text">Team</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="team">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="position">
                                    <div class="header-content">
                                        <span class="header-text">Pos</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="position">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="price">
                                    <div class="header-content">
                                        <span class="header-text">Price</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="price">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="ppg">
                                    <div class="header-content">
                                        <span class="header-text">PPG</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="ppg">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="value_score">
                                    <div class="header-content">
                                        <span class="header-text">PP$</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="value_score">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="games_total">
                                    <div class="header-content">
                                        <span class="header-text">Games</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="games">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="true_value" class="default-sort">
                                    <div class="header-content">
                                        <span class="header-text">True Value</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="true_value">‚ìò</span>
                                            <span class="sort-indicator">‚ñº</span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="form_multiplier">
                                    <div class="header-content">
                                        <span class="header-text">Form</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="form_multiplier">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="fixture_multiplier">
                                    <div class="header-content">
                                        <span class="header-text">Fixture</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="fixture_multiplier">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="starter_multiplier">
                                    <div class="header-content">
                                        <span class="header-text">Starter</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="starter_multiplier">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="xgi_multiplier">
                                    <div class="header-content">
                                        <span class="header-text">xGI</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="xgi_multiplier">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th class="manual-override-header">
                                    <div class="header-content">
                                        <span class="header-text">Starter Override</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="manual_override">‚ìò</span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="xg90">
                                    <div class="header-content">
                                        <span class="header-text">xG90</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="xg90">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="xa90">
                                    <div class="header-content">
                                        <span class="header-text">xA90</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="xa90">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="xgi90">
                                    <div class="header-content">
                                        <span class="header-text">xGI90</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="xgi90">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                                <th data-sort="minutes">
                                    <div class="header-content">
                                        <span class="header-text">Min</span>
                                        <span class="header-icons">
                                            <span class="info-icon" data-column="minutes">‚ìò</span>
                                            <span class="sort-indicator"></span>
                                        </span>
                                    </div>
                                </th>
                            </tr>
                        </thead>
                        <tbody id="player-table-body">
                            <!-- Player rows will be populated by JavaScript -->
                            <tr class="loading-row">
                                <td colspan="17">Loading 633 players...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <!-- Pagination -->
                <div class="pagination">
                    <button id="prev-page" class="btn-secondary" disabled>Previous</button>
                    <span id="page-info">Page 1 of 1</span>
                    <button id="next-page" class="btn-secondary" disabled>Next</button>
                    <div class="page-size">
                        <label for="page-size-select">Per page:</label>
                        <select id="page-size-select">
                            <option value="50">50</option>
                            <option value="100" selected>100</option>
                            <option value="200">200</option>
                            <option value="1000">All</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none;">
        <div class="loading-content">
            <div class="spinner"></div>
            <p>Recalculating True Values...</p>
        </div>
    </div>

    <!-- File Input for CSV Import (Hidden) -->
    <input type="file" id="csv-file-input" accept=".csv" style="display: none;">

    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>